name: 'Lint, Format, and Type Check'
description: 'Run linting, formatting, and type checks'
inputs:
  working-directory:
    description: 'Directory to run checks in'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Run code quality checks
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        # Run linting
        echo "Running linter..."
        uv run lint
        LINT_EXIT_CODE=$?

        # Run format check
        echo -e "\nChecking code formatting..."
        uv run format
        FORMAT_EXIT_CODE=$?

        # Run type check
        echo -e "\nRunning type checks..."
        uv run type-check
        TYPE_EXIT_CODE=$?

        # Add results to summary
        echo "## ðŸ” Code Quality Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        if [ $LINT_EXIT_CODE -eq 0 ]; then
          echo "âœ… **Linting**: All checks passed!" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **Linting**: Failed. Run \`uv run lint\` to check locally." >> $GITHUB_STEP_SUMMARY
        fi

        if [ $FORMAT_EXIT_CODE -eq 0 ]; then
          echo "âœ… **Formatting**: All files properly formatted!" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **Formatting**: Failed. Run \`uv run format\` to auto-format." >> $GITHUB_STEP_SUMMARY
        fi

        if [ $TYPE_EXIT_CODE -eq 0 ]; then
          echo "âœ… **Type Check**: All checks passed!" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **Type Check**: Failed. Run \`uv run type-check\` to check locally." >> $GITHUB_STEP_SUMMARY
        fi

        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Commands" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
        echo "# Run linting" >> $GITHUB_STEP_SUMMARY
        echo "uv run lint" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "# Auto-format code" >> $GITHUB_STEP_SUMMARY
        echo "uv run format" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "# Run type checks" >> $GITHUB_STEP_SUMMARY
        echo "uv run type-check" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

        # Exit with error if any check failed
        if [ $LINT_EXIT_CODE -ne 0 ] || [ $FORMAT_EXIT_CODE -ne 0 ] || [ $TYPE_EXIT_CODE -ne 0 ]; then
          exit 1
        fi
